<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="/favicon.png">
  <title>Orbital Compute Economics</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Load shared model via ES module -->
  <script type="module" src="/src/finance/main.ts"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    :root {
      --bg: #f7f7f7; --surface: #ffffff; --surface2: #f0f0f0; --surface3: #e5e5e5;
      --border: #d0d0d0; --text: #1a1a1a; --muted: #666666;
      --orbital: #0066cc; --ground: #cc3333; --accent: #0066cc; --warning: #cc8800;
      --purple: #6633cc; --orange: #cc6600; --pink: #cc3366;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; background: var(--bg); color: var(--text); font-size: 13px; -webkit-font-smoothing: antialiased; }
    .app { display: grid; grid-template-columns: 280px 1fr; min-height: 100vh; }
    .sidebar { background: var(--surface); border-right: 1px solid var(--border); position: sticky; top: 0; height: 100vh; overflow-y: auto; }
    .main { display: flex; flex-direction: column; min-width: 0; }
    .sidebar-header { padding: 16px; border-bottom: 1px solid var(--border); position: sticky; top: 0; background: var(--surface); z-index: 10; border-left: 3px solid var(--orbital); }
    .sidebar-title { font-size: 13px; font-weight: 600; display: flex; align-items: center; gap: 8px; letter-spacing: -0.01em; }
    .sidebar-title .badge { font-size: 9px; background: var(--orbital); color: white; padding: 2px 6px; border-radius: 3px; font-weight: 600; letter-spacing: 0.02em; }
    .sidebar-subtitle { font-size: 11px; color: var(--muted); margin-top: 4px; }
    .sidebar-content { padding: 12px; }
    .section { background: var(--surface2); border-radius: 4px; padding: 12px; margin-bottom: 12px; border: 1px solid var(--border); }
    .derived-section { background: var(--surface2); border-radius: 4px; padding: 12px; margin-bottom: 12px; border: 1px solid var(--border); }
    .derived-section summary { cursor: pointer; font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: var(--muted); }
    .derived-section summary::before { content: ''; width: 2px; height: 10px; background: var(--accent); display: inline-block; margin-right: 8px; vertical-align: middle; }
    .derived-grid { display: flex; flex-direction: column; gap: 8px; margin-top: 10px; }
    .derived-item { display: flex; flex-direction: column; padding: 6px; background: var(--surface); border-radius: 3px; border: 1px solid var(--border); }
    .derived-label { font-size: 9px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.03em; }
    .derived-value { font-size: 14px; font-weight: 600; color: var(--text); font-variant-numeric: tabular-nums; }
    .derived-unit { font-size: 10px; color: var(--muted); }
    .section-title { font-size: 9px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: var(--muted); margin-bottom: 10px; display: flex; align-items: center; gap: 6px; }
    .section-title::before { content: ''; width: 2px; height: 10px; background: var(--orbital); }
    .section-title.ground::before { background: var(--ground); }
    .slider-val.ground { color: var(--ground); }
    input[type="range"].ground::-webkit-slider-thumb { background: var(--ground); }
    .slider-row { margin-bottom: 10px; }
    .slider-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
    .slider-lbl { font-size: 11px; }
    .slider-val { font-size: 12px; font-weight: 600; color: var(--orbital); font-variant-numeric: tabular-nums; }
    .slider-val .unit { color: var(--muted); font-size: 10px; margin-left: 2px; font-weight: 400; }
    input[type="range"] { width: 100%; height: 4px; background: var(--border); border-radius: 2px; appearance: none; cursor: pointer; }
    input[type="range"]::-webkit-slider-thumb { appearance: none; width: 12px; height: 12px; border-radius: 50%; background: var(--orbital); border: 2px solid var(--surface); box-shadow: 0 1px 2px rgba(0,0,0,0.15); }
    .toggle-row { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid var(--border); }
    .toggle-row:last-child { border-bottom: none; }
    .toggle-lbl { font-size: 11px; }
    .toggle-group { display: flex; align-items: center; gap: 8px; }
    .toggle { position: relative; width: 34px; height: 18px; }
    .toggle input { opacity: 0; width: 0; height: 0; }
    .toggle-track { position: absolute; cursor: pointer; inset: 0; background: var(--border); border-radius: 9px; transition: 0.2s; }
    .toggle-track::before { position: absolute; content: ""; height: 12px; width: 12px; left: 3px; bottom: 3px; background: var(--surface); border-radius: 50%; transition: 0.2s; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
    .toggle input:checked + .toggle-track { background: var(--orbital); }
    .toggle input:checked + .toggle-track::before { transform: translateX(16px); background: white; }
    .year-input { width: 58px; background: var(--surface); border: 1px solid var(--border); border-radius: 3px; color: var(--orbital); font-family: inherit; font-size: 11px; font-weight: 600; padding: 3px 6px; text-align: center; font-variant-numeric: tabular-nums; }
    .year-input:disabled { opacity: 0.4; }
    .toggle-effect { font-size: 9px; color: var(--muted); margin-top: 2px; }
    .toggle-effect.active { color: var(--orbital); }
    .main { display: flex; flex-direction: column; overflow: hidden; }
    .main-header { padding: 12px 16px; border-bottom: 1px solid var(--border); background: var(--surface); display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 8px; }
    .tabs { display: flex; gap: 4px; flex-wrap: wrap; }
    .tab { padding: 8px 14px; background: transparent; border: 1px solid transparent; border-radius: 4px; color: var(--muted); font-size: 10px; font-weight: 600; cursor: pointer; transition: all 0.2s; text-transform: uppercase; letter-spacing: 0.05em; }
    .tab:hover { background: var(--surface2); color: var(--text); }
    .tab.active { background: var(--orbital); color: white; }
    .header-badges { display: flex; gap: 12px; flex-wrap: wrap; }
    .badge-item { display: flex; align-items: center; gap: 6px; padding: 6px 10px; background: var(--surface2); border-radius: 4px; border: 1px solid var(--border); }
    .badge-label { font-size: 9px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.03em; }
    .badge-value { font-size: 13px; font-weight: 600; font-variant-numeric: tabular-nums; }
    .badge-value.orbital { color: var(--orbital); }
    .badge-value.warning { color: var(--warning); }
    .main-content { flex: 1; overflow-y: auto; padding: 16px; }
    .tab-panel { display: none; }
    .tab-panel.active { display: block; }
    .kpis { display: grid; grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)); gap: 10px; margin-bottom: 16px; }
    .kpi { 
      background: linear-gradient(180deg, var(--surface) 0%, var(--surface2) 100%);
      border: 1px solid var(--border); 
      border-radius: 4px; 
      padding: 12px;
      border-top: 2px solid var(--orbital);
    }
    .kpi-label { font-size: 9px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.03em; }
    .kpi-value { font-size: 20px; font-weight: 700; margin-top: 4px; font-variant-numeric: tabular-nums; }
    .kpi.orbital .kpi-value { color: var(--orbital); }
    .kpi.ground .kpi-value { color: var(--ground); }
    .kpi.accent .kpi-value { color: var(--accent); }
    .kpi.warning .kpi-value { color: var(--warning); }
    .kpi.purple .kpi-value { color: var(--purple); }
    .kpi.orbital { border-top-color: var(--orbital); }
    .kpi.ground { border-top-color: var(--ground); }
    .kpi.accent { border-top-color: var(--accent); }
    .kpi.warning { border-top-color: var(--warning); }
    .kpi.purple { border-top-color: var(--purple); }
    .charts { display: flex; flex-direction: column; gap: 12px; }
    .chart-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 14px;
      min-width: 0;
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    }
    .chart-card:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
    /* All charts same size - wide class no longer spans multiple columns */
    .chart-card.wide { grid-column: span 1; }
    .chart-header { margin-bottom: 10px; padding-bottom: 8px; border-bottom: 1px solid var(--border); }
    .chart-title { font-size: 11px; font-weight: 600; }
    .chart-desc { font-size: 10px; color: var(--muted); margin-top: 2px; }
    .chart-box { height: 250px; min-width: 0; }
    /* All charts same height - tall class ignored */
    .chart-card.tall .chart-box { height: 250px; }
    .legend { display: flex; flex-wrap: wrap; gap: 12px; margin-top: 8px; }
    .legend-item { display: flex; align-items: center; gap: 5px; font-size: 10px; color: var(--muted); }
    .legend-dot { width: 10px; height: 10px; border-radius: 2px; }
    .sla-note { font-size: 10px; color: var(--muted); margin-top: 4px; }
    .slider-context { font-size: 10px; color: var(--muted); margin-top: 2px; font-style: italic; }

    /* Responsive layouts */

    /* Large screens */
    @media (min-width: 1800px) {
      .main-content { max-width: 1800px; margin: 0 auto; }
      .charts { grid-template-columns: repeat(4, 1fr); }
    }

    @media (min-width: 1400px) and (max-width: 1799px) {
      .charts { grid-template-columns: repeat(3, 1fr); }
    }

    @media (min-width: 900px) and (max-width: 1399px) {
      .charts { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 899px) {
      .charts { grid-template-columns: 1fr; }
    }

    @media (max-width: 800px) {
      .app { grid-template-columns: 1fr; }
      .sidebar {
        position: relative;
        height: auto;
        max-height: 40vh;
        overflow-y: auto;
        border-right: none;
        border-bottom: 1px solid var(--border);
      }
      .main { min-width: 0; overflow-x: hidden; }
      .main-content { padding: 10px; overflow-x: auto; }
      .kpis { grid-template-columns: repeat(auto-fit, minmax(90px, 1fr)); gap: 8px; }
      .tabs { flex-wrap: wrap; gap: 2px; }
      .tab { padding: 6px 10px; font-size: 10px; }
      .header-badges { display: none; }
      .chart-card { padding: 10px; }
      .chart-box { height: 220px; }
      .chart-card.tall .chart-box { height: 220px; }
    }

    @media (max-width: 600px) {
      body { font-size: 12px; }
      .sidebar-content { padding: 8px; }
      .section { padding: 10px; margin-bottom: 8px; }
      .slider-row { margin-bottom: 8px; }
      .kpis { grid-template-columns: repeat(2, 1fr); }
      .kpi { padding: 8px; }
      .kpi-value { font-size: 14px; }
      .chart-card { padding: 8px; }
      .chart-box { height: 200px; }
      .chart-card.tall .chart-box { height: 200px; }
      .legend { gap: 8px; }
      .legend-item { font-size: 9px; }
      .tab { padding: 6px 10px; font-size: 10px; }
      .main-header { padding: 8px 12px; }
    }
    
    /* LCOC Hero Header */
    .lcoc-hero {
      background: linear-gradient(135deg, var(--orbital) 0%, #004d99 100%);
      color: white;
      padding: 16px 24px;
      border-bottom: 1px solid rgba(0,0,0,0.1);
    }
    .lcoc-hero-inner {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 24px;
      flex-wrap: wrap;
    }
    .lcoc-main { }
    .lcoc-label { font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em; opacity: 0.85; }
    .lcoc-value { font-size: 42px; font-weight: 700; letter-spacing: -0.02em; line-height: 1.1; }
    .lcoc-stats { display: flex; gap: 24px; }
    .lcoc-stat { display: flex; flex-direction: column; padding: 8px 16px; background: rgba(255,255,255,0.1); border-radius: 6px; }
    .lcoc-stat-label { font-size: 10px; text-transform: uppercase; letter-spacing: 0.03em; opacity: 0.8; }
    .lcoc-stat-value { font-size: 18px; font-weight: 600; font-variant-numeric: tabular-nums; }
    .lcoc-advantage { color: #7dffb3; }
    .lcoc-whitepaper-link { 
      font-size: 12px; 
      font-weight: 500; 
      color: white; 
      text-decoration: none; 
      padding: 10px 18px; 
      background: rgba(255,255,255,0.15); 
      border-radius: 6px;
      transition: background 0.2s;
    }
    .lcoc-whitepaper-link:hover { background: rgba(255,255,255,0.25); }
    .back-link {
      font-size: 12px;
      font-weight: 500;
      color: rgba(255,255,255,0.9);
      text-decoration: none;
      padding: 8px 14px;
      background: rgba(255,255,255,0.1);
      border-radius: 6px;
      transition: background 0.2s;
    }
    .back-link:hover { background: rgba(255,255,255,0.2); }
    @media (max-width: 800px) {
      .lcoc-hero { padding: 12px 16px; }
      .lcoc-value { font-size: 32px; }
      .lcoc-stats { gap: 12px; }
      .lcoc-stat { padding: 6px 12px; }
      .lcoc-whitepaper-link { font-size: 11px; padding: 6px 10px; }
    }
  </style>
</head>
<body>
<div class="lcoc-hero">
  <div class="lcoc-hero-inner">
    <a href="/" class="back-link">← Main Simulator</a>
    <div class="lcoc-main">
      <div class="lcoc-label">Baseline LCOC Crossover</div>
      <div class="lcoc-value" id="hero-crossover">2031</div>
    </div>
    <div class="lcoc-stats">
      <div class="lcoc-stat">
        <span class="lcoc-stat-label">Orbital 2035</span>
        <span class="lcoc-stat-value" id="hero-orb35">$0.42</span>
      </div>
      <div class="lcoc-stat">
        <span class="lcoc-stat-label">Ground 2035</span>
        <span class="lcoc-stat-value" id="hero-gnd35">$0.58</span>
      </div>
    </div>
    <a href="/finance/whitepaper.html" class="lcoc-whitepaper-link">Read Whitepaper →</a>
  </div>
</div>
<div class="app">
  <div class="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-title">Orbital Compute </div>
      <div class="sidebar-subtitle">Physics-Based Analysis</div>
    </div>
    <div class="sidebar-content">
      
      <div class="section">
        <div class="section-title">Breakthroughs</div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">Thermal Breakthrough</span><span class="slider-val"><span id="v-thermalYear">2030</span></span></div>
          <input type="range" id="thermalYear" min="2026" max="2040" value="2030">
          <div class="toggle-effect" id="eff-thermal">50× lighter heat rejection, MW-class platforms</div>
        </div>
        <div class="toggle-row">
          <div>
            <div class="toggle-lbl">Space Fission</div>
            <div class="toggle-effect" id="eff-fission">10-100× orbital power only</div>
          </div>
          <div class="toggle-group">
            <input type="number" class="year-input" id="year-fission" value="2035" min="2028" max="2050">
            <label class="toggle"><input type="checkbox" id="tog-fission" checked><span class="toggle-track"></span></label>
          </div>
        </div>
        <div class="toggle-row">
          <div>
            <div class="toggle-lbl">Ground SMR Buildout</div>
            <div class="toggle-effect" id="eff-smr">Ground supply +10-25 GW/yr</div>
          </div>
          <div class="toggle-group">
            <input type="number" class="year-input" id="year-smr" value="2032" min="2028" max="2050">
            <label class="toggle"><input type="checkbox" id="tog-smr" checked><span class="toggle-track"></span></label>
          </div>
        </div>
        <div class="toggle-row">
          <div>
            <div class="toggle-lbl">Fusion Power</div>
            <div class="toggle-effect" id="eff-fusion">GW stations, 100× ground</div>
          </div>
          <div class="toggle-group">
            <input type="number" class="year-input" id="year-fusion" value="2045" min="2035" max="2050">
            <label class="toggle"><input type="checkbox" id="tog-fusion"><span class="toggle-track"></span></label>
          </div>
        </div>
        <div class="toggle-row">
          <div>
            <div class="toggle-lbl">Thermodynamic Computing</div>
            <div class="toggle-effect" id="eff-thermo">TSUs via thermal noise. <a href="https://extropic.ai" target="_blank" style="color: var(--accent);">extropic.ai</a></div>
          </div>
          <div class="toggle-group">
            <input type="number" class="year-input" id="year-thermo" value="2029" min="2027" max="2035">
            <label class="toggle"><input type="checkbox" id="tog-thermo"><span class="toggle-track"></span></label>
          </div>
        </div>
        <div id="thermo-sliders" style="display: none;">
          <div class="slider-row">
            <div class="slider-header"><span class="slider-lbl">Ground Mult</span><span class="slider-val"><span id="v-thermoGroundMult">100</span><span class="unit">×</span></span></div>
            <input type="range" id="thermoGroundMult" min="1" max="3" step="0.1" value="2">
            <div class="toggle-effect">Room-temp silicon TSUs. Limited by thermal noise floor.</div>
          </div>
          <div class="slider-row">
            <div class="slider-header"><span class="slider-lbl">Space Mult</span><span class="slider-val"><span id="v-thermoSpaceMult">1000</span><span class="unit">×</span></span></div>
            <input type="range" id="thermoSpaceMult" min="2" max="4" step="0.1" value="3">
            <div class="toggle-effect">Superconducting TSUs (Josephson junctions). Passive cryo cooling to ~20K.</div>
          </div>
        </div>
        <div class="toggle-row">
          <div>
            <div class="toggle-lbl">Photonic Computing</div>
            <div class="toggle-effect" id="eff-photonic">Light-based matrix ops for deterministic workloads</div>
          </div>
          <div class="toggle-group">
            <input type="number" class="year-input" id="year-photonic" value="2035" min="2026" max="2045">
            <label class="toggle"><input type="checkbox" id="tog-photonic"><span class="toggle-track"></span></label>
          </div>
        </div>
        <div id="photonic-sliders" style="display: none;">
          <div class="slider-row">
            <div class="slider-header"><span class="slider-lbl">Ground Mult</span><span class="slider-val"><span id="v-photonicGroundMult">30</span><span class="unit">×</span></span></div>
            <input type="range" id="photonicGroundMult" min="1" max="3" step="0.1" value="1.48">
            <div class="toggle-effect">Optical matrix multiply. Room temperature.</div>
          </div>
          <div class="slider-row">
            <div class="slider-header"><span class="slider-lbl">Space Mult</span><span class="slider-val"><span id="v-photonicSpaceMult">150</span><span class="unit">×</span></span></div>
            <input type="range" id="photonicSpaceMult" min="1" max="4" step="0.1" value="2.18">
            <div class="toggle-effect">Vacuum optics = no atmospheric scatter.</div>
          </div>
          <div class="slider-row">
            <div class="slider-header"><span class="slider-lbl">Prob. Workload</span><span class="slider-val"><span id="v-workloadProbabilistic">15</span><span class="unit">%</span></span></div>
            <input type="range" id="workloadProbabilistic" min="5" max="50" value="15">
            <div class="toggle-effect">Fraction needing thermodynamic (sampling-heavy).</div>
          </div>
        </div>
      </div>

      <div class="section">
        <div class="section-title">Thermal</div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">Emissivity</span><span class="slider-val"><span id="v-emissivity">0.85</span></span></div>
          <input type="range" id="emissivity" min="70" max="95" value="85">
        </div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">Op Temp</span><span class="slider-val"><span id="v-opTemp">365</span><span class="unit">K</span></span></div>
          <input type="range" id="opTemp" min="300" max="400" value="365">
        </div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">Rad Learn</span><span class="slider-val"><span id="v-radLearn">50</span><span class="unit">kg/MW/yr</span></span></div>
          <input type="range" id="radLearn" min="0" max="100" value="50">
        </div>
      </div>
      
      <div class="section">
        <div class="section-title">Power</div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">Solar Eff</span><span class="slider-val"><span id="v-solarEff">20</span><span class="unit">%</span></span></div>
          <input type="range" id="solarEff" min="15" max="50" value="20">
        </div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">Solar Learn</span><span class="slider-val"><span id="v-solarLearn">0.8</span><span class="unit">%/yr</span></span></div>
          <input type="range" id="solarLearn" min="0" max="20" value="8">
        </div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">Base Power</span><span class="slider-val"><span id="v-basePower">300</span><span class="unit">kW</span></span></div>
          <input type="range" id="basePower" min="100" max="800" value="300">
        </div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">Compute %</span><span class="slider-val"><span id="v-computeFrac">68</span><span class="unit">%</span></span></div>
          <input type="range" id="computeFrac" min="50" max="80" value="68">
        </div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">Battery Dens</span><span class="slider-val"><span id="v-battDens">280</span><span class="unit">Wh/kg</span></span></div>
          <input type="range" id="battDens" min="200" max="500" value="280">
        </div>
      </div>
      
      <div class="section">
        <div class="section-title">Compute</div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">Rad Penalty</span><span class="slider-val"><span id="v-radPen">30</span><span class="unit">%</span></span></div>
          <input type="range" id="radPen" min="10" max="60" value="30">
        </div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">AI Learn Rate</span><span class="slider-val"><span id="v-aiLearn">20</span><span class="unit">%/yr</span></span></div>
          <input type="range" id="aiLearn" min="5" max="35" value="20">
        </div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">Sat Lifetime</span><span class="slider-val"><span id="v-satLife">10</span><span class="unit">yrs</span></span></div>
          <input type="range" id="satLife" min="3" max="15" value="10">
        </div>
      </div>
      
      <div class="section">
        <div class="section-title">Economics</div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">Launch $/kg</span><span class="slider-val">$<span id="v-launchCost">1500</span></span></div>
          <input type="range" id="launchCost" min="200" max="2500" value="1500">
        </div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">Launch Learn</span><span class="slider-val"><span id="v-launchLearn">18</span><span class="unit">%</span></span></div>
          <input type="range" id="launchLearn" min="10" max="50" value="18">
        </div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">Floor $/kg</span><span class="slider-val">$<span id="v-launchFloor">10</span></span></div>
          <input type="range" id="launchFloor" min="5" max="100" value="10">
        </div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">Prod Mult</span><span class="slider-val"><span id="v-prodMult">2.5</span><span class="unit">×</span></span></div>
          <input type="range" id="prodMult" min="10" max="50" value="25">
        </div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">Maint Cost</span><span class="slider-val"><span id="v-maintCost">2</span><span class="unit">%/yr</span></span></div>
          <input type="range" id="maintCost" min="1" max="30" value="2">
        </div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">WACC Orbital</span><span class="slider-val"><span id="v-waccOrbital">10</span><span class="unit">%</span></span></div>
          <input type="range" id="waccOrbital" min="5" max="25" value="10">
        </div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">WACC Ground</span><span class="slider-val ground"><span id="v-waccGround">8</span><span class="unit">%</span></span></div>
          <input type="range" class="ground" id="waccGround" min="3" max="15" value="8">
        </div>
      </div>
      
      <div class="section">
        <div class="section-title">Infrastructure</div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">Base BW</span><span class="slider-val"><span id="v-bandwidth">50</span><span class="unit">Tbps</span></span></div>
          <input type="range" id="bandwidth" min="10" max="200" value="50">
        </div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">BW Growth</span><span class="slider-val"><span id="v-bwGrowth">35</span><span class="unit">%/yr</span></span></div>
          <input type="range" id="bwGrowth" min="15" max="50" value="35">
        </div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">BW $/Gbps</span><span class="slider-val">$<span id="v-bwCost">50</span><span class="unit">k</span></span></div>
          <input type="range" id="bwCost" min="10" max="200" value="50">
        </div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">BW/TFLOP</span><span class="slider-val"><span id="v-gbpsPerTflop">10</span><span class="unit">Mbps</span></span></div>
          <input type="range" id="gbpsPerTflop" min="1" max="50" value="10">
        </div>
      </div>
      
      <div class="section">
        <div class="section-title ground">Ground DC</div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">Ground PUE</span><span class="slider-val ground"><span id="v-groundPue">1.30</span></span></div>
          <input type="range" class="ground" id="groundPue" min="105" max="180" value="130">
        </div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">Energy $/kWh</span><span class="slider-val ground">$<span id="v-energyCost">0.065</span></span></div>
          <input type="range" class="ground" id="energyCost" min="30" max="150" value="65">
        </div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">Energy Escal</span><span class="slider-val ground"><span id="v-energyEscal">4</span><span class="unit">%/yr</span></span></div>
          <input type="range" class="ground" id="energyEscal" min="0" max="10" value="4">
        </div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">Build Delay</span><span class="slider-val ground"><span id="v-interconnect">48</span><span class="unit">mo</span></span></div>
          <input type="range" class="ground" id="interconnect" min="6" max="60" value="48">
        </div>
      </div>
      
      <div class="section">
        <div class="section-title ground">Market</div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">2026 Demand</span><span class="slider-val ground"><span id="v-demand2025">195</span><span class="unit">Exaflops</span></span></div>
          <input type="range" class="ground" id="demand2025" min="90" max="450" value="195">
          <div class="slider-context" id="demand-context">(≈ 307 Petatok/yr | ≈ 65 GW @ baseline)</div>
        </div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">Demand Growth</span><span class="slider-val ground"><span id="v-demandGrowth">55</span><span class="unit">%/yr</span></span></div>
          <input type="range" class="ground" id="demandGrowth" min="20" max="80" value="55">
        </div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">Batch Eligible</span><span class="slider-val"><span id="v-orbitalEligibleShare">35</span><span class="unit">%</span></span></div>
          <input type="range" id="orbitalEligibleShare" min="10" max="80" value="35">
        </div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">2026 Supply</span><span class="slider-val ground"><span id="v-supply2025">60</span><span class="unit">GW</span></span></div>
          <input type="range" class="ground" id="supply2025" min="30" max="150" value="60">
        </div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">Supply Growth</span><span class="slider-val ground"><span id="v-supplyGrowth">8</span><span class="unit">%/yr</span></span></div>
          <input type="range" class="ground" id="supplyGrowth" min="5" max="25" value="8">
        </div>
      </div>

      <div class="section">
        <div class="section-title ground">Behind-the-Meter</div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">BTM Share</span><span class="slider-val ground"><span id="v-btmShare">15</span><span class="unit">%</span></span></div>
          <input type="range" class="ground" id="btmShare" min="0" max="40" value="15">
          <div class="toggle-effect">On-site solar+storage bypassing grid queues</div>
        </div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">BTM Deploy</span><span class="slider-val ground"><span id="v-btmDelay">12</span><span class="unit">mo</span></span></div>
          <input type="range" class="ground" id="btmDelay" min="6" max="24" value="12">
        </div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">BTM Capex</span><span class="slider-val ground"><span id="v-btmCapexMult">1.35</span><span class="unit">×</span></span></div>
          <input type="range" class="ground" id="btmCapexMult" min="100" max="200" value="135">
        </div>
        <div class="slider-row">
          <div class="slider-header"><span class="slider-lbl">BTM Energy</span><span class="slider-val ground">$<span id="v-btmEnergyCost">0.040</span><span class="unit">/kWh</span></span></div>
          <input type="range" class="ground" id="btmEnergyCost" min="20" max="80" value="40">
          <div class="toggle-effect">Solar+storage LCOS (Lazard data)</div>
        </div>
      </div>

      <details class="derived-section">
        <summary class="section-title">Derived Values</summary>
        <div class="derived-grid">
          <div class="derived-item">
            <span class="derived-label">Rad Power</span>
            <span class="derived-value" id="d-radPower">--</span>
            <span class="derived-unit">W/m²</span>
          </div>
          <div class="derived-item">
            <span class="derived-label">Rad Mass</span>
            <span class="derived-value" id="d-radMass">--</span>
            <span class="derived-unit">kg/MW</span>
          </div>
          <div class="derived-item">
            <span class="derived-label">Launch LEO</span>
            <span class="derived-value" id="d-launchLeo">--</span>
            <span class="derived-unit">$/kg</span>
          </div>
          <div class="derived-item">
            <span class="derived-label">Launch GEO</span>
            <span class="derived-value" id="d-launchGeo">--</span>
            <span class="derived-unit">$/kg</span>
          </div>
          <div class="derived-item">
            <span class="derived-label">Sat Power</span>
            <span class="derived-value" id="d-satPower">--</span>
            <span class="derived-unit">kW</span>
          </div>
          <div class="derived-item">
            <span class="derived-label">Sat Mass</span>
            <span class="derived-value" id="d-satMass">--</span>
            <span class="derived-unit">kg</span>
          </div>
          <div class="derived-item">
            <span class="derived-label">Demand '35</span>
            <span class="derived-value" id="d-demand35">--</span>
            <span class="derived-unit">GW</span>
          </div>
          <div class="derived-item">
            <span class="derived-label">Supply '35</span>
            <span class="derived-value" id="d-supply35">--</span>
            <span class="derived-unit">GW</span>
          </div>
        </div>
      </details>
      
    </div>
  </div>
  
  <div class="main">
    <div class="main-header">
      <div class="tabs">
        <button class="tab active" data-tab="core">Core</button>
        <button class="tab" data-tab="market">Market</button>
        <button class="tab" data-tab="constraints">Constraints</button>
        <button class="tab" data-tab="physics">Physics</button>
        <button class="tab" data-tab="futures">Futures</button>
      </div>
      <div class="header-badges">
        <div class="badge-item">
          <span class="badge-label">Crossover</span>
          <span class="badge-value orbital" id="badge-crossover">--</span>
        </div>
        <div class="badge-item">
          <span class="badge-label">Fleet 2050</span>
          <span class="badge-value warning" id="badge-fleet50">--</span>
        </div>
      </div>
    </div>
    
    <div class="main-content">
      <!-- CORE TAB -->
      <div class="tab-panel active" data-tab="core">
        <div class="kpis">
          <div class="kpi orbital"><div class="kpi-label">Orb 2035</div><div class="kpi-value" id="kpi-orb35">--</div></div>
          <div class="kpi ground"><div class="kpi-label">Gnd 2035</div><div class="kpi-value" id="kpi-gnd35">--</div></div>
          <div class="kpi orbital"><div class="kpi-label">Orb 2050</div><div class="kpi-value" id="kpi-orb50">--</div></div>
          <div class="kpi ground"><div class="kpi-label">Gnd 2050</div><div class="kpi-value" id="kpi-gnd50">--</div></div>
          <div class="kpi warning"><div class="kpi-label">Delivered 2035</div><div class="kpi-value" id="kpi-tokens35">--</div></div>
          <div class="kpi accent"><div class="kpi-label">Delivered 2050</div><div class="kpi-value" id="kpi-tokens50">--</div></div>
        </div>
        <div class="charts">
          <div class="chart-card wide tall">
            <div class="chart-header">
              <div class="chart-title">LCOC with Uncertainty ($/GPU-hr)</div>
              <div class="chart-desc">Orbital vs Ground market price. Bands = scenario range.</div>
              <div class="sla-note">SLA: 99.9% uptime (8.76 hrs/yr downtime)</div>
            </div>
            <div class="chart-box"><canvas id="c-lcoc"></canvas></div>
            <div class="legend">
              <div class="legend-item"><div class="legend-dot" style="background:var(--orbital)"></div>Orbital (baseline)</div>
              <div class="legend-item"><div class="legend-dot" style="background:rgba(0,102,204,0.3)"></div>Orbital range</div>
              <div class="legend-item"><div class="legend-dot" style="background:var(--ground)"></div>Ground (market)</div>
            </div>
          </div>
          <div class="chart-card">
            <div class="chart-header">
              <div class="chart-title">Orbital Fleet (TW)</div>
              <div class="chart-desc">All shells: LEO, MEO, GEO, Cislunar</div>
            </div>
            <div class="chart-box"><canvas id="c-fleet"></canvas></div>
            <div class="legend">
              <div class="legend-item"><div class="legend-dot" style="background:var(--orbital)"></div>LEO</div>
              <div class="legend-item"><div class="legend-dot" style="background:var(--accent)"></div>MEO</div>
              <div class="legend-item"><div class="legend-dot" style="background:var(--warning)"></div>GEO</div>
              <div class="legend-item"><div class="legend-dot" style="background:var(--purple)"></div>Cislunar</div>
            </div>
          </div>
          <div class="chart-card">
            <div class="chart-header">
              <div class="chart-title">Carbon (gCO₂/TFLOP-hr)</div>
              <div class="chart-desc">Orbital = embodied; Ground = grid + embodied</div>
            </div>
            <div class="chart-box"><canvas id="c-carbon"></canvas></div>
            <div class="legend">
              <div class="legend-item"><div class="legend-dot" style="background:var(--orbital)"></div>Orbital</div>
              <div class="legend-item"><div class="legend-dot" style="background:var(--ground)"></div>Ground</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- MARKET TAB -->
      <div class="tab-panel" data-tab="market">
        <div class="kpis">
          <div class="kpi warning"><div class="kpi-label">Peak Premium</div><div class="kpi-value" id="kpi-peakPrem">--</div></div>
          <div class="kpi ground"><div class="kpi-label">Premium 2035</div><div class="kpi-value" id="kpi-prem35">--</div></div>
          <div class="kpi accent"><div class="kpi-label">Unmet 2035</div><div class="kpi-value" id="kpi-unmet35">--</div></div>
        </div>
        <div class="charts">
          <div class="chart-card wide tall">
            <div class="chart-header">
              <div class="chart-title">Supply vs Demand (GW)</div>
              <div class="chart-desc">Gap drives scarcity premium. Orbital-eligible demand = total × eligible share.</div>
            </div>
            <div class="chart-box"><canvas id="c-supplyDemand"></canvas></div>
            <div class="legend">
              <div class="legend-item"><div class="legend-dot" style="background:var(--ground)"></div>Total Demand</div>
              <div class="legend-item"><div class="legend-dot" style="background:var(--muted)"></div>Ground Supply</div>
              <div class="legend-item"><div class="legend-dot" style="background:var(--orbital)"></div>Total Supply</div>
            </div>
          </div>
          <div class="chart-card wide">
            <div class="chart-header">
              <div class="chart-title">Scarcity Premium (×)</div>
              <div class="chart-desc">Price multiplier from unmet demand</div>
            </div>
            <div class="chart-box"><canvas id="c-scarcity"></canvas></div>
          </div>
        </div>
      </div>
      
      <!-- CONSTRAINTS TAB -->
      <div class="tab-panel" data-tab="constraints">
        <div class="kpis">
          <div class="kpi accent"><div class="kpi-label">BW Util 2035</div><div class="kpi-value" id="kpi-bwUtil">--</div></div>
          <div class="kpi orbital"><div class="kpi-label">Platforms 2035</div><div class="kpi-value" id="kpi-plat35">--</div></div>
          <div class="kpi purple"><div class="kpi-label">Platforms 2050</div><div class="kpi-value" id="kpi-plat50">--</div></div>
        </div>
        <div class="charts">
          <div class="chart-card wide">
            <div class="chart-header">
              <div class="chart-title">Shell Utilization (%)</div>
              <div class="chart-desc">LEO: 300k, MEO: 50k, GEO: 1.8k, Cislunar: 700k capacity</div>
            </div>
            <div class="chart-box"><canvas id="c-shellUtil"></canvas></div>
            <div class="legend">
              <div class="legend-item"><div class="legend-dot" style="background:var(--orbital)"></div>LEO</div>
              <div class="legend-item"><div class="legend-dot" style="background:var(--accent)"></div>MEO</div>
              <div class="legend-item"><div class="legend-dot" style="background:var(--warning)"></div>GEO</div>
              <div class="legend-item"><div class="legend-dot" style="background:var(--purple)"></div>Cislunar</div>
            </div>
          </div>
          <div class="chart-card">
            <div class="chart-header">
              <div class="chart-title">Bandwidth Utilization (%)</div>
              <div class="chart-desc">Available / needed. Low = stranded capacity.</div>
            </div>
            <div class="chart-box"><canvas id="c-bwUtil"></canvas></div>
          </div>
          <div class="chart-card">
            <div class="chart-header">
              <div class="chart-title">Bandwidth Capacity (Tbps)</div>
              <div class="chart-desc">Ground segment optical links</div>
            </div>
            <div class="chart-box"><canvas id="c-bandwidth"></canvas></div>
          </div>
          <div class="chart-card">
            <div class="chart-header">
              <div class="chart-title">Stranded Capex Penalty (×)</div>
              <div class="chart-desc">LCOC multiplier from underutilization</div>
            </div>
            <div class="chart-box"><canvas id="c-stranded"></canvas></div>
          </div>
          <div class="chart-card">
            <div class="chart-header">
              <div class="chart-title">Radiator Mass (kg/kW)</div>
              <div class="chart-desc">Thermal breakthrough: 50× lighter heat rejection</div>
            </div>
            <div class="chart-box"><canvas id="c-thermal"></canvas></div>
          </div>
          <div class="chart-card">
            <div class="chart-header">
              <div class="chart-title">Bottleneck Analysis</div>
              <div class="chart-desc">Dominant constraint each period</div>
            </div>
            <div class="chart-box"><canvas id="c-bottleneck"></canvas></div>
            <div class="legend">
              <div class="legend-item"><div class="legend-dot" style="background:rgba(204,102,0,0.9)"></div>Thermal</div>
              <div class="legend-item"><div class="legend-dot" style="background:rgba(204,170,0,0.9)"></div>Power</div>
              <div class="legend-item"><div class="legend-dot" style="background:rgba(0,102,204,0.9)"></div>Bandwidth</div>
              <div class="legend-item"><div class="legend-dot" style="background:rgba(102,51,204,0.9)"></div>Orbital Slots</div>
              <div class="legend-item"><div class="legend-dot" style="background:rgba(0,153,102,0.9)"></div>Demand</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- PHYSICS TAB -->
      <div class="tab-panel" data-tab="physics">
        <div class="kpis">
          <div class="kpi orbital"><div class="kpi-label">LEO Power</div><div class="kpi-value" id="kpi-leo">--</div></div>
          <div class="kpi purple"><div class="kpi-label">Cislunar</div><div class="kpi-value" id="kpi-cis">--</div></div>
          <div class="kpi accent"><div class="kpi-label">Mass 2035</div><div class="kpi-value" id="kpi-mass">--</div></div>
        </div>
        <div class="charts">
          <div class="chart-card">
            <div class="chart-header">
              <div class="chart-title">Mass Breakdown (kg)</div>
              <div class="chart-desc">Advanced thermal: 50× lighter</div>
            </div>
            <div class="chart-box"><canvas id="c-mass"></canvas></div>
            <div class="legend">
              <div class="legend-item"><div class="legend-dot" style="background:var(--warning)"></div>Solar/Reactor</div>
              <div class="legend-item"><div class="legend-dot" style="background:var(--purple)"></div>Battery</div>
              <div class="legend-item"><div class="legend-dot" style="background:var(--orbital)"></div>Compute</div>
              <div class="legend-item"><div class="legend-dot" style="background:var(--ground)"></div>Radiator</div>
              <div class="legend-item"><div class="legend-dot" style="background:var(--muted)"></div>Structure</div>
            </div>
          </div>
          <div class="chart-card">
            <div class="chart-header">
              <div class="chart-title">Launch Cost ($/kg)</div>
              <div class="chart-desc">Learning curve to $15/kg floor</div>
            </div>
            <div class="chart-box"><canvas id="c-launch"></canvas></div>
          </div>
          <div class="chart-card">
            <div class="chart-header">
              <div class="chart-title">Compute Efficiency (GFLOPS/W)</div>
              <div class="chart-desc">AI learning rate drives improvement</div>
            </div>
            <div class="chart-box"><canvas id="c-efficiency"></canvas></div>
            <div class="legend">
              <div class="legend-item"><div class="legend-dot" style="background:var(--orbital)"></div>Orbital</div>
              <div class="legend-item"><div class="legend-dot" style="background:var(--ground)"></div>Ground</div>
            </div>
          </div>
          <div class="chart-card wide">
            <div class="chart-header">
              <div class="chart-title">Platform Power by Shell (MW)</div>
              <div class="chart-desc">Fission/fusion enable 10-1000× power jump</div>
            </div>
            <div class="chart-box"><canvas id="c-power"></canvas></div>
            <div class="legend">
              <div class="legend-item"><div class="legend-dot" style="background:var(--orbital)"></div>LEO</div>
              <div class="legend-item"><div class="legend-dot" style="background:var(--accent)"></div>MEO</div>
              <div class="legend-item"><div class="legend-dot" style="background:var(--warning)"></div>GEO</div>
              <div class="legend-item"><div class="legend-dot" style="background:var(--purple)"></div>Cislunar</div>
            </div>
          </div>
          <div class="chart-card">
            <div class="chart-header">
              <div class="chart-title">Specific Power (W/kg)</div>
              <div class="chart-desc">Key figure of merit for orbital</div>
            </div>
            <div class="chart-box"><canvas id="c-specPower"></canvas></div>
          </div>
          <div class="chart-card">
            <div class="chart-header">
              <div class="chart-title">Power Budget (%)</div>
              <div class="chart-desc">Compute vs thermal vs housekeeping</div>
            </div>
            <div class="chart-box"><canvas id="c-powerBudget"></canvas></div>
            <div class="legend">
              <div class="legend-item"><div class="legend-dot" style="background:var(--orbital)"></div>Compute</div>
              <div class="legend-item"><div class="legend-dot" style="background:var(--orange)"></div>Thermal</div>
              <div class="legend-item"><div class="legend-dot" style="background:var(--muted)"></div>Housekeeping</div>
            </div>
          </div>
          <div class="chart-card">
            <div class="chart-header">
              <div class="chart-title">Data Rate per Platform (Gbps)</div>
              <div class="chart-desc">Link budget based on compute output</div>
            </div>
            <div class="chart-box"><canvas id="c-dataRate"></canvas></div>
          </div>
          <div class="chart-card">
            <div class="chart-header">
              <div class="chart-title">Radiation: Reliability Overhead (%)</div>
              <div class="chart-desc">SEU-driven redundancy by shell (improves with rad-hard tech)</div>
            </div>
            <div class="chart-box"><canvas id="c-reliability"></canvas></div>
            <div class="legend">
              <div class="legend-item"><div class="legend-dot" style="background:var(--orbital)"></div>LEO</div>
              <div class="legend-item"><div class="legend-dot" style="background:var(--warning)"></div>MEO</div>
              <div class="legend-item"><div class="legend-dot" style="background:var(--accent)"></div>GEO</div>
              <div class="legend-item"><div class="legend-dot" style="background:var(--purple)"></div>Cislunar</div>
            </div>
          </div>
          <div class="chart-card">
            <div class="chart-header">
              <div class="chart-title">EROL (Energy Return on Launch)</div>
              <div class="chart-desc">Lifetime energy output vs launch energy</div>
            </div>
            <div class="chart-box"><canvas id="c-erol"></canvas></div>
          </div>
        </div>
      </div>
      
      <!-- FUTURES TAB -->
      <div class="tab-panel" data-tab="futures">
        <div class="kpis">
          <div class="kpi orbital"><div class="kpi-label">Aggressive</div><div class="kpi-value" id="kpi-crossAgg">--</div></div>
          <div class="kpi accent"><div class="kpi-label">Baseline</div><div class="kpi-value" id="kpi-crossBase">--</div></div>
          <div class="kpi ground"><div class="kpi-label">Conservative</div><div class="kpi-value" id="kpi-crossCons">--</div></div>
        </div>

        <!-- Feedback Loops & Lunar Readiness -->
        <div class="feedback-panels" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; padding: 16px;">
          <!-- Fleet & Starship Panel -->
          <div class="feedback-panel" style="background: var(--surface); border-radius: 12px; padding: 16px; border: 1px solid var(--border);">
            <div class="panel-title" style="font-weight: 600; color: var(--orbital); margin-bottom: 12px; font-size: 14px;">Fleet (2040)</div>
            <div class="panel-row" style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid var(--border); font-size: 13px;"><span>LEO Platforms</span><span id="kpi-leoCapacity40" style="font-weight: 500;">--</span></div>
            <div class="panel-row" style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid var(--border); font-size: 13px;"><span>Total Fleet Mass</span><span id="kpi-fleetMass40" style="font-weight: 500;">--</span></div>
            <div class="panel-row" style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid var(--border); font-size: 13px;"><span>Starship Flights to Deploy</span><span id="kpi-starshipFlights40" style="font-weight: 500;">--</span></div>
            <div class="panel-row" style="display: flex; justify-content: space-between; padding: 6px 0; font-size: 13px;"><span>Annual Flights</span><span id="kpi-annualFlights40" style="font-weight: 500;">--</span></div>
          </div>

          <!-- AI Acceleration Panel -->
          <div class="feedback-panel" style="background: var(--surface); border-radius: 12px; padding: 16px; border: 1px solid var(--border);">
            <div class="panel-title" style="font-weight: 600; color: var(--accent); margin-bottom: 12px; font-size: 14px;">AI Acceleration (2040)</div>
            <div class="panel-row" style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid var(--border); font-size: 13px;"><span>Global Compute</span><span id="kpi-globalCompute40" style="font-weight: 500;">--</span></div>
            <div class="panel-row" style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid var(--border); font-size: 13px;"><span>R&D Stock (K)</span><span id="kpi-rndStock40" style="font-weight: 500;">--</span></div>
            <div class="panel-row" style="display: flex; justify-content: space-between; padding: 6px 0; font-size: 13px;"><span>Launch Learn Boost</span><span id="kpi-launchLearnBoost" style="font-weight: 500;">--</span></div>
          </div>

          <!-- Lunar Readiness Panel -->
          <div class="feedback-panel" style="background: var(--surface); border-radius: 12px; padding: 16px; border: 1px solid var(--border);">
            <div class="panel-title" style="font-weight: 600; color: var(--ground); margin-bottom: 12px; font-size: 14px;">Lunar Infrastructure</div>
            <div class="panel-row" style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid var(--border); font-size: 13px;"><span>Readiness (2040)</span><span id="kpi-lunarReadiness" style="font-weight: 500;">--</span></div>
            <div class="panel-row" style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid var(--border); font-size: 13px;"><span>Unlock Year</span><span id="kpi-lunarUnlock" style="font-weight: 500;">--</span></div>
            <div class="panel-status" id="kpi-lunarStatus" style="margin-top: 8px; padding: 8px; background: rgba(0,0,0,0.05); border-radius: 6px; font-size: 12px; color: var(--muted); text-align: center;">--</div>
          </div>
        </div>

        <div class="charts">
          <div class="chart-card wide tall">
            <div class="chart-header">
              <div class="chart-title">LCOC Scenarios ($/GPU-hr)</div>
              <div class="chart-desc">Deployment ramp timing under different assumptions</div>
            </div>
            <div class="chart-box"><canvas id="c-lcocScenarios"></canvas></div>
            <div class="legend">
              <div class="legend-item"><div class="legend-dot" style="background:var(--orbital)"></div>Orbital (baseline)</div>
              <div class="legend-item"><div class="legend-dot" style="background:rgba(0,102,204,0.3)"></div>Orbital range</div>
              <div class="legend-item"><div class="legend-dot" style="background:var(--muted)"></div>Ground (market)</div>
            </div>
          </div>
          <div class="chart-card wide">
            <div class="chart-header">
              <div class="chart-title">Carbon Scenarios (gCO₂/TFLOP-hr)</div>
              <div class="chart-desc">Emissions trajectory under each scenario</div>
            </div>
            <div class="chart-box"><canvas id="c-carbonScenarios"></canvas></div>
            <div class="legend">
              <div class="legend-item"><div class="legend-dot" style="background:var(--orbital)"></div>Orbital (baseline)</div>
              <div class="legend-item"><div class="legend-dot" style="background:rgba(0,102,204,0.3)"></div>Orbital range</div>
            </div>
          </div>
          <div class="chart-card wide">
            <div class="chart-header">
              <div class="chart-title">Efficiency Scenarios (GFLOPS/W)</div>
              <div class="chart-desc">Compute efficiency improvement</div>
            </div>
            <div class="chart-box"><canvas id="c-effScenarios"></canvas></div>
            <div class="legend">
              <div class="legend-item"><div class="legend-dot" style="background:var(--orbital)"></div>Orbital (baseline)</div>
              <div class="legend-item"><div class="legend-dot" style="background:rgba(0,102,204,0.3)"></div>Orbital range</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="module">
/*
================================================================================
ORBITAL COMPUTE ECONOMICS SIMULATOR - Finance View
================================================================================
Uses shared model from /src/model/ via OrbitalModel global
================================================================================
*/

// Import shared model
const {
  STEFAN_BOLTZMANN, SOLAR_CONSTANT, YEARS, SLA, SHELLS, STARSHIP_PAYLOAD_KG,
  SCENARIOS, defaults,
  getLaunchCost, getRadiatorMassPerMW, getRadiatorPower, getGroundEfficiency,
  getOrbitalEfficiency, getBandwidth, getLEOPower, getCislunarPower,
  getCRF, getDemand, getBtmShare, getGroundSupply, getDemandPressure,
  getShellRadiationEffects, getAllShellReliability,
  calcSatellite, calcGround, calcFleet, resetFleetTracker,
  getScenarioParams, runScenario,
  updateRnDStock, updateLaunchLearning,
  getLunarReadiness, getLunarUnlockYear
} = window.OrbitalModel;

const BASELINE_EFFICIENCY = 3000;  // GFLOPS/W for standard ground compute (fixed reference)

// P is mutable state that syncs with sliders
let P = { ...defaults };

let fleetResults = [];


// Wrapper for runScenario - uses local P as base params
function runFinanceScenario(scenario) {
  return runScenario(scenario, P);
}

// Format helpers (not in shared model)
function formatPrice(value) {
  if (value >= 100) return value.toFixed(0);
  if (value >= 10) return value.toFixed(1);
  if (value >= 1) return value.toFixed(2);
  return value.toFixed(3);
}

function formatDeliveredTokens(tokens) {
  const peta = tokens / 1e15;
  if (peta >= 100) return peta.toFixed(0) + ' Peta';
  if (peta >= 10) return peta.toFixed(1) + ' Peta';
  if (peta >= 1) return peta.toFixed(2) + ' Peta';
  return peta.toFixed(3) + ' Peta';
}

function formatDemandContext(exaflops) {
  const petatokPerYear = exaflops * 1.575;
  const gw = exaflops / 3;
  return '(≈ ' + petatokPerYear.toFixed(0) + ' Petatok/yr | ≈ ' + gw.toFixed(0) + ' GW @ baseline)';
}

function formatMass(kg) {
  if (kg >= 1e9) return (kg / 1e9).toFixed(1) + ' Mt';
  if (kg >= 1e6) return (kg / 1e6).toFixed(1) + ' kt';
  if (kg >= 1e3) return (kg / 1e3).toFixed(0) + ' t';
  return kg.toFixed(0) + ' kg';
}

// Launch learning boost helper
const CADENCE_BOOST_THRESHOLD = 100;
const CADENCE_BOOST_MAX = 0.05;
const BASELINE_FLIGHTS_PER_YEAR = 50;

function getLaunchLearningBoost(annualMassKg) {
  const orbitalFlights = annualMassKg / STARSHIP_PAYLOAD_KG;
  const totalFlightsThisYear = orbitalFlights + BASELINE_FLIGHTS_PER_YEAR;
  return Math.min(CADENCE_BOOST_MAX, (totalFlightsThisYear / CADENCE_BOOST_THRESHOLD) * CADENCE_BOOST_MAX);
}

// ============================================
// CHARTS
// ============================================

Chart.defaults.color = '#666666';
Chart.defaults.borderColor = '#d0d0d0';
Chart.defaults.font.family = 'Inter';

let charts = {};

function initCharts() {
  const opts = (yLabel, log = false) => ({
    responsive: true, maintainAspectRatio: false,
    interaction: { mode: 'index', intersect: false },
    plugins: { legend: { display: false }, tooltip: { enabled: true, mode: 'index', intersect: false } },
    scales: { y: { type: log ? 'logarithmic' : 'linear', title: { display: true, text: yLabel } } }
  });
  const stackOpts = (yLabel) => ({
    responsive: true, maintainAspectRatio: false,
    interaction: { mode: 'index', intersect: false },
    plugins: { legend: { display: false }, tooltip: { enabled: true, mode: 'index', intersect: false } },
    scales: { x: { stacked: true }, y: { stacked: true, title: { display: true, text: yLabel } } }
  });
  
  // Core - LCOC with uncertainty bands
  charts.lcoc = new Chart(document.getElementById('c-lcoc'), {
    type: 'line', data: { labels: YEARS, datasets: [
      // Aggressive bound (upper for uncertainty)
      { data: [], borderColor: 'transparent', backgroundColor: 'rgba(0,102,204,0.2)', fill: '+1', tension: 0.3, pointRadius: 0 },
      // Baseline orbital
      { data: [], borderColor: '#0066cc', borderWidth: 2, tension: 0.3, pointRadius: 0 },
      // Conservative bound (lower)
      { data: [], borderColor: 'transparent', backgroundColor: 'rgba(0,102,204,0.2)', fill: '-1', tension: 0.3, pointRadius: 0 },
      // Ground market
      { data: [], borderColor: '#cc3333', borderWidth: 2, tension: 0.3, pointRadius: 0 }
    ]}, options: opts('$/GPU-hr', true)
  });
  
  
  // Fleet by shell - stacked area chart
  charts.fleet = new Chart(document.getElementById('c-fleet'), {
    type: 'line', data: { labels: YEARS, datasets: [
      { data: [], borderColor: '#0066cc', backgroundColor: 'rgba(0,102,204,0.5)', fill: true, tension: 0.3 },
      { data: [], borderColor: '#0066cc', backgroundColor: 'rgba(0,102,204,0.5)', fill: true, tension: 0.3 },
      { data: [], borderColor: '#cc8800', backgroundColor: 'rgba(204,136,0,0.5)', fill: true, tension: 0.3 },
      { data: [], borderColor: '#6633cc', backgroundColor: 'rgba(102,51,204,0.5)', fill: true, tension: 0.3 }
    ]}, options: {
      ...opts('TW', true),
      scales: {
        x: { stacked: true },
        y: { stacked: true, beginAtZero: true }
      }
    }
  });
  
  charts.carbon = new Chart(document.getElementById('c-carbon'), {
    type: 'line', data: { labels: YEARS, datasets: [
      { data: [], borderColor: '#0066cc', tension: 0.3 },
      { data: [], borderColor: '#cc3333', tension: 0.3 }
    ]}, options: opts('gCO₂/TFLOP-hr')
  });
  
  // Market
  charts.supplyDemand = new Chart(document.getElementById('c-supplyDemand'), {
    type: 'line', data: { labels: YEARS, datasets: [
      { data: [], borderColor: '#cc3333', tension: 0.3, borderWidth: 2 },
      { data: [], borderColor: '#7a7a88', borderDash: [4,4], tension: 0.3 },
      { data: [], borderColor: '#0066cc', tension: 0.3, borderWidth: 2 }
    ]}, options: opts('GW', true)
  });
  
  charts.scarcity = new Chart(document.getElementById('c-scarcity'), {
    type: 'line', data: { labels: YEARS, datasets: [
      { data: [], borderColor: '#cc3333', backgroundColor: 'rgba(204,51,51,0.1)', fill: true, tension: 0.3 }
    ]}, options: opts('×')
  });
  
  charts.efficiency = new Chart(document.getElementById('c-efficiency'), {
    type: 'line', data: { labels: YEARS, datasets: [
      { data: [], borderColor: '#0066cc', tension: 0.3 },
      { data: [], borderColor: '#cc3333', tension: 0.3 }
    ]}, options: opts('GFLOPS/W', true)
  });
  
  // Constraints - Shell utilization for all 4 shells
  charts.shellUtil = new Chart(document.getElementById('c-shellUtil'), {
    type: 'line', data: { labels: YEARS, datasets: [
      { data: [], borderColor: '#0066cc', tension: 0.3 },
      { data: [], borderColor: '#0066cc', tension: 0.3 },
      { data: [], borderColor: '#cc8800', tension: 0.3 },
      { data: [], borderColor: '#6633cc', tension: 0.3 }
    ]}, options: opts('%')
  });
  
  charts.bandwidth = new Chart(document.getElementById('c-bandwidth'), {
    type: 'line', data: { labels: YEARS, datasets: [
      { data: [], borderColor: '#0066cc', backgroundColor: 'rgba(0,102,204,0.1)', fill: true, tension: 0.3 }
    ]}, options: opts('Tbps', true)
  });
  
  charts.bwUtil = new Chart(document.getElementById('c-bwUtil'), {
    type: 'line', data: { labels: YEARS, datasets: [
      { data: [], borderColor: '#cc6600', backgroundColor: 'rgba(204,102,0,0.1)', fill: true, tension: 0.3 }
    ]}, options: opts('%')
  });
  
  // Stranded capex penalty (LCOC multiplier from underutilization)
  charts.stranded = new Chart(document.getElementById('c-stranded'), {
    type: 'line', data: { labels: YEARS, datasets: [
      { data: [], borderColor: '#cc3333', backgroundColor: 'rgba(204,51,51,0.1)', fill: true, tension: 0.3 }
    ]}, options: opts('×')
  });
  
  charts.thermal = new Chart(document.getElementById('c-thermal'), {
    type: 'line', data: { labels: YEARS, datasets: [
      { data: [], borderColor: '#cc3333', backgroundColor: 'rgba(204,51,51,0.1)', fill: true, tension: 0.1 }
    ]}, options: opts('kg/kW')
  });
  
  charts.erol = new Chart(document.getElementById('c-erol'), {
    type: 'line', data: { labels: YEARS, datasets: [
      { data: [], borderColor: '#cc8800', backgroundColor: 'rgba(204,136,0,0.1)', fill: true, tension: 0.3 }
    ]}, options: opts('×')
  });
  
  charts.bottleneck = new Chart(document.getElementById('c-bottleneck'), {
    type: 'bar', data: { labels: YEARS, datasets: [
      { data: [], backgroundColor: 'rgba(204,102,0,0.7)' },  // Thermal - orange
      { data: [], backgroundColor: 'rgba(204,170,0,0.7)' },  // Power - gold
      { data: [], backgroundColor: 'rgba(0,102,204,0.7)' },  // Bandwidth - blue
      { data: [], backgroundColor: 'rgba(102,51,204,0.7)' }, // Slots - purple
      { data: [], backgroundColor: 'rgba(0,153,102,0.7)' }   // Demand - green
    ]}, options: stackOpts('Constraint')
  });
  
  // Physics - all 4 shells
  charts.power = new Chart(document.getElementById('c-power'), {
    type: 'line', data: { labels: YEARS, datasets: [
      { data: [], borderColor: '#1a8a6a', tension: 0.1, borderWidth: 2 }, // LEO
      { data: [], borderColor: '#0066cc', tension: 0.1, borderWidth: 2 }, // MEO
      { data: [], borderColor: '#cc8800', tension: 0.1, borderWidth: 2 }, // GEO
      { data: [], borderColor: '#6633cc', tension: 0.1, borderWidth: 2 }  // Cislunar
    ]}, options: opts('MW', true)
  });
  
  charts.specPower = new Chart(document.getElementById('c-specPower'), {
    type: 'line', data: { labels: YEARS, datasets: [
      { data: [], borderColor: '#0066cc', backgroundColor: 'rgba(0,102,204,0.1)', fill: true, tension: 0.3 }
    ]}, options: opts('W/kg', true)
  });
  
  charts.mass = new Chart(document.getElementById('c-mass'), {
    type: 'bar', data: { labels: YEARS, datasets: [
      { data: [], backgroundColor: '#cc8800' },
      { data: [], backgroundColor: '#6633cc' },
      { data: [], backgroundColor: '#0066cc' },
      { data: [], backgroundColor: '#cc3333' },
      { data: [], backgroundColor: '#7a7a88' }
    ]}, options: stackOpts('kg')
  });
  
  charts.powerBudget = new Chart(document.getElementById('c-powerBudget'), {
    type: 'bar', data: { labels: YEARS, datasets: [
      { data: [], backgroundColor: 'rgba(0,102,204,0.7)' },     // Compute - teal
      { data: [], backgroundColor: 'rgba(204,102,0,0.7)' },    // Thermal - orange
      { data: [], backgroundColor: 'rgba(122,122,136,0.7)' }    // Housekeeping - gray
    ]}, options: stackOpts('%')
  });
  
  charts.launch = new Chart(document.getElementById('c-launch'), {
    type: 'line', data: { labels: YEARS, datasets: [
      { data: [], borderColor: '#cc6600', tension: 0.3 }
    ]}, options: opts('$/kg', true)
  });
  
  charts.dataRate = new Chart(document.getElementById('c-dataRate'), {
    type: 'line', data: { labels: YEARS, datasets: [
      { data: [], borderColor: '#0066cc', backgroundColor: 'rgba(0,102,204,0.1)', fill: true, tension: 0.3 }
    ]}, options: opts('Gbps', true)
  });
  
  // Reliability overhead by shell (SEU penalty)
  charts.reliability = new Chart(document.getElementById('c-reliability'), {
    type: 'line', data: { labels: YEARS, datasets: [
      { data: [], borderColor: '#0066cc', tension: 0.3, borderWidth: 2 }, // LEO
      { data: [], borderColor: '#cc8800', tension: 0.3, borderWidth: 2 }, // MEO
      { data: [], borderColor: '#0066cc', tension: 0.3, borderWidth: 2 }, // GEO
      { data: [], borderColor: '#6633cc', tension: 0.3, borderWidth: 2 }  // Cislunar
    ]}, options: opts('%')
  });
  
  // Futures - with uncertainty bands
  charts.lcocScenarios = new Chart(document.getElementById('c-lcocScenarios'), {
    type: 'line', data: { labels: YEARS, datasets: [
      // Aggressive bound (upper)
      { data: [], borderColor: 'transparent', backgroundColor: 'rgba(0,102,204,0.2)', fill: '+1', tension: 0.3, pointRadius: 0 },
      // Baseline orbital
      { data: [], borderColor: '#0066cc', borderWidth: 2, tension: 0.3, pointRadius: 0 },
      // Conservative bound (lower)
      { data: [], borderColor: 'transparent', backgroundColor: 'rgba(0,102,204,0.2)', fill: '-1', tension: 0.3, pointRadius: 0 },
      // Ground market
      { data: [], borderColor: '#7a7a88', borderDash: [4,4], borderWidth: 2, tension: 0.3, pointRadius: 0 }
    ]}, options: opts('$/GPU-hr', true)
  });
  
  charts.carbonScenarios = new Chart(document.getElementById('c-carbonScenarios'), {
    type: 'line', data: { labels: YEARS, datasets: [
      // Aggressive bound
      { data: [], borderColor: 'transparent', backgroundColor: 'rgba(0,102,204,0.2)', fill: '+1', tension: 0.3, pointRadius: 0 },
      // Baseline
      { data: [], borderColor: '#0066cc', borderWidth: 2, tension: 0.3, pointRadius: 0 },
      // Conservative bound
      { data: [], borderColor: 'transparent', backgroundColor: 'rgba(0,102,204,0.2)', fill: '-1', tension: 0.3, pointRadius: 0 }
    ]}, options: opts('gCO₂/TFLOP-hr')
  });
  
  charts.effScenarios = new Chart(document.getElementById('c-effScenarios'), {
    type: 'line', data: { labels: YEARS, datasets: [
      // Aggressive bound
      { data: [], borderColor: 'transparent', backgroundColor: 'rgba(0,102,204,0.2)', fill: '+1', tension: 0.3, pointRadius: 0 },
      // Baseline
      { data: [], borderColor: '#0066cc', borderWidth: 2, tension: 0.3, pointRadius: 0 },
      // Conservative bound
      { data: [], borderColor: 'transparent', backgroundColor: 'rgba(0,102,204,0.2)', fill: '-1', tension: 0.3, pointRadius: 0 }
    ]}, options: opts('GFLOPS/W', true)
  });
}

function update() {
  // Run all scenarios using shared model with local P
  const agg = runScenario('aggressive', P);
  const base = runScenario('baseline', P);
  const cons = runScenario('conservative', P);
  
  // Use baseline for main display
  const sats = base.sats;
  const gnds = base.gnds;
  fleetResults = base.fleets;
  const crossoverYear = base.crossoverYear;
  
  const i30 = 4, i35 = 9, i40 = 14, i50 = 24;
  
  // Header badges
  document.getElementById('badge-crossover').textContent = crossoverYear || 'Never';
  document.getElementById('badge-fleet50').textContent = fleetResults[i50].totalPowerTw.toFixed(1) + ' TW';
  
  // Hero LCOC display
  document.getElementById('hero-crossover').textContent = crossoverYear || 'Never';
  document.getElementById('hero-orb35').textContent = '$' + formatPrice(fleetResults[i35].lcocEffective);
  document.getElementById('hero-gnd35').textContent = '$' + formatPrice(gnds[i35].market);
  // Core KPIs - just 2035 and 2050
  document.getElementById('kpi-orb35').textContent = '$' + formatPrice(fleetResults[i35].lcocEffective);
  document.getElementById('kpi-gnd35').textContent = '$' + formatPrice(gnds[i35].market);
  document.getElementById('kpi-orb50').textContent = '$' + formatPrice(fleetResults[i50].lcocEffective);
  document.getElementById('kpi-gnd50').textContent = '$' + formatPrice(gnds[i50].market);
  
  // Derived values
  const radPower = P.emissivity * STEFAN_BOLTZMANN * Math.pow(P.opTemp, 4);
  document.getElementById('d-radPower').textContent = radPower.toFixed(0);
  document.getElementById('d-radMass').textContent = sats[i30].radMassPerMW.toFixed(0);
  document.getElementById('d-launchLeo').textContent = getLaunchCost(2030, P, 'leo').toFixed(0);
  document.getElementById('d-launchGeo').textContent = getLaunchCost(2030, P, 'geo').toFixed(0);
  document.getElementById('d-satPower').textContent = sats[i30].powerKw.toFixed(0);
  document.getElementById('d-satMass').textContent = sats[i30].dryMass.toFixed(0);
  document.getElementById('d-demand35').textContent = gnds[i35].demand.toFixed(0);
  document.getElementById('d-supply35').textContent = gnds[i35].groundSupply.toFixed(0);
  
  // Market KPIs
  document.getElementById('kpi-peakPrem').textContent = Math.max(...gnds.map(g => g.premium)).toFixed(1) + '×';
  document.getElementById('kpi-prem35').textContent = gnds[i35].premium.toFixed(1) + '×';
  document.getElementById('kpi-unmet35').textContent = (gnds[i35].unmetRatio * 100).toFixed(0) + '%';
  
  // Constraints KPIs
  document.getElementById('kpi-bwUtil').textContent = (fleetResults[i35].bwUtil * 100).toFixed(0) + '%';
  const totalPlat35 = fleetResults[i35].leoPlatforms + fleetResults[i35].meoPlatforms + 
                      fleetResults[i35].geoPlatforms + fleetResults[i35].cisPlatforms;
  const totalPlat50 = fleetResults[i50].leoPlatforms + fleetResults[i50].meoPlatforms + 
                      fleetResults[i50].geoPlatforms + fleetResults[i50].cisPlatforms;
  document.getElementById('kpi-plat35').textContent = (totalPlat35 / 1000).toFixed(0) + 'k';
  document.getElementById('kpi-plat50').textContent = (totalPlat50 / 1000).toFixed(0) + 'k';

  // Delivered compute KPIs
  document.getElementById('kpi-tokens35').textContent = formatDeliveredTokens(fleetResults[i35].deliveredTokensPerYear) + ' tok/yr';
  document.getElementById('kpi-tokens50').textContent = formatDeliveredTokens(fleetResults[i50].deliveredTokensPerYear) + ' tok/yr';

  // Physics KPIs
  document.getElementById('kpi-leo').textContent = (sats[i35].powerKw / 1000).toFixed(1) + ' MW';
  document.getElementById('kpi-cis').textContent = (fleetResults[i35].cislunarPowerKw / 1000).toFixed(0) + ' MW';
  document.getElementById('kpi-mass').textContent = sats[i35].dryMass.toFixed(0) + ' kg';
  
  // Futures KPIs
  document.getElementById('kpi-crossAgg').textContent = agg.crossoverYear || 'Never';
  document.getElementById('kpi-crossBase').textContent = base.crossoverYear || 'Never';
  document.getElementById('kpi-crossCons').textContent = cons.crossoverYear || 'Never';

  // === FEEDBACK LOOP CALCULATIONS ===
  // Track simulation state through years
  let cumulativeMassToOrbitKg = 0;
  let rndStock = 0;
  const states = [];
  const lunarReadinessHistory = [];

  YEARS.forEach((year, i) => {
    const fleet = fleetResults[i];
    const gnd = gnds[i];

    // Update cumulative mass
    cumulativeMassToOrbitKg += fleet.annualMassKg;

    // Current metrics
    const orbitalPowerTW = fleet.totalPowerTw;
    const deliveredComputeExaflops = fleet.fleetTflops / 1e6;  // TFLOPS to Exaflops
    const groundComputeExaflops = gnd.groundSupply * 3;  // Rough: 3 Exaflops per GW
    const globalComputeExaflops = deliveredComputeExaflops + groundComputeExaflops;

    // Update R&D stock
    rndStock = updateRnDStock(globalComputeExaflops, rndStock);

    // Get launch learning boost
    const launchLearnBoost = getLaunchLearningBoost(fleet.annualMassKg);
    const effectiveLaunchLearnRate = P.launchLearn + launchLearnBoost;

    const state = {
      year,
      cumulativeMassToOrbitKg,
      orbitalPowerTW,
      globalComputeExaflops,
      rndStock,
      effectiveLaunchLearnRate
    };

    // Calculate lunar readiness
    const lunarDetails = getLunarReadiness(state, P);
    state.lunarReadiness = lunarDetails.overallReadiness;

    states.push(state);
    lunarReadinessHistory.push({ year, readiness: lunarDetails.overallReadiness, details: lunarDetails });
  });

  // Get 2040 values (index 14)
  const state40 = states[i40];
  const lunar40 = lunarReadinessHistory[i40]?.details;
  const lunarUnlockYear = getLunarUnlockYear(lunarReadinessHistory);

  // Fleet & Starship KPIs (2040)
  document.getElementById('kpi-leoCapacity40').textContent = `${(fleetResults[i40].leoPlatforms / 1000).toFixed(0)}k / ${(SHELLS.leo.capacity / 1000).toFixed(0)}k`;
  document.getElementById('kpi-fleetMass40').textContent = formatMass(fleetResults[i40].fleetMassKg);
  document.getElementById('kpi-starshipFlights40').textContent = Math.round(fleetResults[i40].starshipFlightsToDeploy).toLocaleString();
  document.getElementById('kpi-annualFlights40').textContent = Math.round(fleetResults[i40].annualStarshipFlights).toLocaleString();

  // AI Acceleration KPIs (2040)
  document.getElementById('kpi-globalCompute40').textContent = state40.globalComputeExaflops.toFixed(0) + ' Exaflops';
  document.getElementById('kpi-rndStock40').textContent = state40.rndStock.toFixed(2);
  document.getElementById('kpi-launchLearnBoost').textContent = `+${((state40.effectiveLaunchLearnRate - P.launchLearn) * 100).toFixed(1)}%`;

  // Lunar Readiness KPIs
  if (lunar40) {
    document.getElementById('kpi-lunarReadiness').textContent = (lunar40.overallReadiness * 100).toFixed(0) + '%';
    document.getElementById('kpi-lunarStatus').textContent = lunar40.status;
  }
  document.getElementById('kpi-lunarUnlock').textContent = lunarUnlockYear?.toString() || 'Not viable';

  // Toggle effects - thermal is always on
  document.getElementById('eff-thermal').className = 'toggle-effect active';
  document.getElementById('eff-fission').className = 'toggle-effect' + (P.fissionOn ? ' active' : '');
  document.getElementById('eff-smr').className = 'toggle-effect' + (P.smrOn ? ' active' : '');
  document.getElementById('eff-fusion').className = 'toggle-effect' + (P.fusionOn ? ' active' : '');
  document.getElementById('eff-thermo').className = 'toggle-effect' + (P.thermoOn ? ' active' : '');
  
  // Core charts - LCOC with uncertainty
  charts.lcoc.data.datasets[0].data = agg.fleets.map(f => f.lcocEffective);
  charts.lcoc.data.datasets[1].data = base.fleets.map(f => f.lcocEffective);
  charts.lcoc.data.datasets[2].data = cons.fleets.map(f => f.lcocEffective);
  charts.lcoc.data.datasets[3].data = gnds.map(g => g.market);
  charts.lcoc.update();
  
  // Fleet by shell
  charts.fleet.data.datasets[0].data = fleetResults.map(f => f.leoPowerTw);
  charts.fleet.data.datasets[1].data = fleetResults.map(f => f.meoPowerTw);
  charts.fleet.data.datasets[2].data = fleetResults.map(f => f.geoPowerTw);
  charts.fleet.data.datasets[3].data = fleetResults.map(f => f.cisPowerTw);
  charts.fleet.update();
  
  charts.carbon.data.datasets[0].data = sats.map(s => s.carbonPerTflop);
  charts.carbon.data.datasets[1].data = gnds.map(g => g.carbonPerTflop);
  charts.carbon.update();
  
  // Market charts
  charts.supplyDemand.data.datasets[0].data = gnds.map(g => g.demand);
  charts.supplyDemand.data.datasets[1].data = gnds.map(g => g.groundSupply);
  charts.supplyDemand.data.datasets[2].data = gnds.map(g => g.totalSupply);
  charts.supplyDemand.update();
  
  charts.scarcity.data.datasets[0].data = gnds.map(g => g.premium);
  charts.scarcity.update();
  
  charts.efficiency.data.datasets[0].data = sats.map(s => s.gflopsW);
  charts.efficiency.data.datasets[1].data = gnds.map(g => g.gflopsW);
  charts.efficiency.update();
  
  // Constraints charts - all 4 shells
  charts.shellUtil.data.datasets[0].data = fleetResults.map(f => f.leoUtil * 100);
  charts.shellUtil.data.datasets[1].data = fleetResults.map(f => f.meoUtil * 100);
  charts.shellUtil.data.datasets[2].data = fleetResults.map(f => f.geoUtil * 100);
  charts.shellUtil.data.datasets[3].data = fleetResults.map(f => f.cisUtil * 100);
  charts.shellUtil.update();
  
  charts.bwUtil.data.datasets[0].data = fleetResults.map(f => f.bwUtil * 100);
  charts.bwUtil.update();
  
  charts.bandwidth.data.datasets[0].data = fleetResults.map(f => f.bwAvailGbps / 1000); // Convert to Tbps for display
  charts.bandwidth.update();
  
  // Stranded capex penalty (1/sellableUtil - shows LCOC inflation from underutilization)
  charts.stranded.data.datasets[0].data = fleetResults.map(f => 1 / Math.max(0.01, f.sellableUtil || 1));
  charts.stranded.update();
  
  // Thermal: show radiator specific mass (kg/kW) - thermal breakthrough makes this 50× lower
  charts.thermal.data.datasets[0].data = sats.map(s => getRadiatorMassPerMW(s.year, s.powerKw, P) / 1000);
  charts.thermal.update();
  
  charts.bottleneck.data.datasets[0].data = fleetResults.map(f => f.bottleneck === 'thermal' ? 1 : 0);
  charts.bottleneck.data.datasets[1].data = fleetResults.map(f => f.bottleneck === 'power' ? 1 : 0);
  charts.bottleneck.data.datasets[2].data = fleetResults.map(f => f.bottleneck === 'bandwidth' ? 1 : 0);
  charts.bottleneck.data.datasets[3].data = fleetResults.map(f => f.bottleneck === 'slots' ? 1 : 0);
  charts.bottleneck.data.datasets[4].data = fleetResults.map(f => f.bottleneck === 'demand' ? 1 : 0);
  charts.bottleneck.update();
  
  // Physics charts - all 4 shells
  charts.power.data.datasets[0].data = sats.map(s => s.powerKw / 1000); // LEO
  charts.power.data.datasets[1].data = sats.map(s => s.powerKw * 0.8 / 1000); // MEO (80% of LEO)
  charts.power.data.datasets[2].data = sats.map((s, i) => {
    const year = 2026 + i;
    const hasFission = P.fissionOn && year >= P.fissionYear;
    const hasThermal = P.thermalOn && year >= P.thermalYear;
    const mult = hasFission ? 20 : hasThermal ? 10 : 5;
    return s.powerKw * mult / 1000; // GEO
  });
  charts.power.data.datasets[3].data = fleetResults.map(f => f.cislunarPowerKw / 1000); // Cislunar
  charts.power.update();
  
  charts.specPower.data.datasets[0].data = sats.map(s => s.specPower);
  charts.specPower.update();
  
  charts.mass.data.datasets[0].data = sats.map(s => s.mass.power);
  charts.mass.data.datasets[1].data = sats.map(s => s.mass.batt);
  charts.mass.data.datasets[2].data = sats.map(s => s.mass.comp);
  charts.mass.data.datasets[3].data = sats.map(s => s.mass.rad);
  charts.mass.data.datasets[4].data = sats.map(s => s.mass.struct);
  charts.mass.update();
  
  // Power budget: compute (68%), thermal management (~22%), housekeeping (~10%)
  // Power budget: compute, thermal management, housekeeping
  const compPct = P.computeFrac * 100;
  const thermalPct = (1 - P.computeFrac) * 0.7 * 100; // ~70% of non-compute goes to thermal
  const housePct = 100 - compPct - thermalPct;
  charts.powerBudget.data.datasets[0].data = YEARS.map(() => compPct);
  charts.powerBudget.data.datasets[1].data = YEARS.map(() => thermalPct);
  charts.powerBudget.data.datasets[2].data = YEARS.map(() => housePct);
  charts.powerBudget.update();
  
  charts.launch.data.datasets[0].data = YEARS.map(y => getLaunchCost(y, P, 'leo'));
  charts.launch.update();
  
  charts.dataRate.data.datasets[0].data = sats.map(s => s.dataRateGbps);
  charts.dataRate.update();
  
  // Reliability overhead by shell (SEU penalty as % overhead)
  charts.reliability.data.datasets[0].data = YEARS.map(y => (getShellRadiationEffects('leo', y, P).seuPenalty - 1) * 100);
  charts.reliability.data.datasets[1].data = YEARS.map(y => (getShellRadiationEffects('meo', y, P).seuPenalty - 1) * 100);
  charts.reliability.data.datasets[2].data = YEARS.map(y => (getShellRadiationEffects('geo', y, P).seuPenalty - 1) * 100);
  charts.reliability.data.datasets[3].data = YEARS.map(y => (getShellRadiationEffects('cislunar', y, P).seuPenalty - 1) * 100);
  charts.reliability.update();
  
  charts.erol.data.datasets[0].data = sats.map(s => s.erol);
  charts.erol.update();
  
  // Futures charts
  charts.lcocScenarios.data.datasets[0].data = agg.fleets.map(f => f.lcocEffective);
  charts.lcocScenarios.data.datasets[1].data = base.fleets.map(f => f.lcocEffective);
  charts.lcocScenarios.data.datasets[2].data = cons.fleets.map(f => f.lcocEffective);
  charts.lcocScenarios.data.datasets[3].data = base.gnds.map(g => g.market);
  charts.lcocScenarios.update();
  
  charts.carbonScenarios.data.datasets[0].data = agg.sats.map(s => s.carbonPerTflop);
  charts.carbonScenarios.data.datasets[1].data = base.sats.map(s => s.carbonPerTflop);
  charts.carbonScenarios.data.datasets[2].data = cons.sats.map(s => s.carbonPerTflop);
  charts.carbonScenarios.update();
  
  charts.effScenarios.data.datasets[0].data = agg.sats.map(s => s.gflopsW);
  charts.effScenarios.data.datasets[1].data = base.sats.map(s => s.gflopsW);
  charts.effScenarios.data.datasets[2].data = cons.sats.map(s => s.gflopsW);
  charts.effScenarios.update();
}

// ============================================
// EVENTS
// ============================================

document.addEventListener('DOMContentLoaded', () => {
  initCharts();

  // Thermal is always on - just handle the year slider
  P.thermalOn = true;
  const thermalYearSlider = document.getElementById('thermalYear');
  const thermalYearVal = document.getElementById('v-thermalYear');
  if (thermalYearSlider) {
    thermalYearSlider.addEventListener('input', () => {
      P.thermalYear = parseInt(thermalYearSlider.value);
      if (thermalYearVal) thermalYearVal.textContent = P.thermalYear;
      update();
    });
  }
  
  // Other breakthroughs have toggles
  ['fission', 'fusion', 'smr', 'thermo', 'photonic'].forEach(tech => {
    const toggle = document.getElementById('tog-' + tech);
    const yearInput = document.getElementById('year-' + tech);
    if (!toggle) return;

    P[tech + 'On'] = toggle.checked;
    if (yearInput) yearInput.disabled = !toggle.checked;

    // Special handling for thermo sliders visibility
    if (tech === 'thermo') {
      const thermoSliders = document.getElementById('thermo-sliders');
      if (thermoSliders) thermoSliders.style.display = toggle.checked ? 'block' : 'none';
    }
    // Special handling for photonic sliders visibility
    if (tech === 'photonic') {
      const photonicSliders = document.getElementById('photonic-sliders');
      if (photonicSliders) photonicSliders.style.display = toggle.checked ? 'block' : 'none';
    }

    toggle.addEventListener('change', () => {
      P[tech + 'On'] = toggle.checked;
      if (yearInput) yearInput.disabled = !toggle.checked;

      // Special handling for thermo sliders visibility
      if (tech === 'thermo') {
        const thermoSliders = document.getElementById('thermo-sliders');
        if (thermoSliders) thermoSliders.style.display = toggle.checked ? 'block' : 'none';
      }
      // Special handling for photonic sliders visibility
      if (tech === 'photonic') {
        const photonicSliders = document.getElementById('photonic-sliders');
        if (photonicSliders) photonicSliders.style.display = toggle.checked ? 'block' : 'none';
      }

      update();
    });
    if (yearInput) {
      yearInput.addEventListener('change', () => {
        P[tech + 'Year'] = parseInt(yearInput.value);
        update();
      });
    }
  });
  
  const sliders = {
    emissivity: { p: 'emissivity', s: 0.01, f: v => v.toFixed(2) },
    opTemp: { p: 'opTemp', s: 1, f: v => v },
    radLearn: { p: 'radLearn', s: 1, f: v => v },
    solarEff: { p: 'solarEff', s: 0.01, f: v => Math.round(v * 100) },
    solarLearn: { p: 'solarLearn', s: 0.001, f: v => (v * 1000).toFixed(1) },
    basePower: { p: 'basePower', s: 1, f: v => v },
    computeFrac: { p: 'computeFrac', s: 0.01, f: v => Math.round(v * 100) },
    battDens: { p: 'battDens', s: 1, f: v => v },
    satLife: { p: 'satLife', s: 1, f: v => v },
    radPen: { p: 'radPen', s: 0.01, f: v => Math.round(v * 100) },
    aiLearn: { p: 'aiLearn', s: 0.01, f: v => Math.round(v * 100) },
    launchCost: { p: 'launchCost', s: 1, f: v => v },
    launchLearn: { p: 'launchLearn', s: 0.01, f: v => Math.round(v * 100) },
    launchFloor: { p: 'launchFloor', s: 1, f: v => v },
    prodMult: { p: 'prodMult', s: 0.1, f: v => v.toFixed(1) },
    maintCost: { p: 'maintCost', s: 0.01, f: v => Math.round(v * 100) },
    waccOrbital: { p: 'waccOrbital', s: 0.01, f: v => Math.round(v * 100) },
    waccGround: { p: 'waccGround', s: 0.01, f: v => Math.round(v * 100) },
    bandwidth: { p: 'bandwidth', s: 1, f: v => v },
    bwGrowth: { p: 'bwGrowth', s: 0.01, f: v => Math.round(v * 100) },
    bwCost: { p: 'bwCost', s: 1, f: v => v },
    gbpsPerTflop: { p: 'gbpsPerTflop', s: 0.001, f: v => Math.round(v * 1000) }, // Display as Mbps
    groundPue: { p: 'groundPue', s: 0.01, f: v => v.toFixed(2) },
    energyCost: { p: 'energyCost', s: 0.001, f: v => v.toFixed(3) },
    energyEscal: { p: 'energyEscal', s: 0.01, f: v => Math.round(v * 100) },
    interconnect: { p: 'interconnect', s: 1, f: v => v },
    // demand2025 is handled specially - slider is in Exaflops, model uses GW
    demandGrowth: { p: 'demandGrowth', s: 0.01, f: v => Math.round(v * 100) },
    orbitalEligibleShare: { p: 'orbitalEligibleShare', s: 0.01, f: v => Math.round(v * 100) },
    supply2025: { p: 'supply2025', s: 1, f: v => v },
    supplyGrowth: { p: 'supplyGrowth', s: 0.01, f: v => Math.round(v * 100) },
    workloadProbabilistic: { p: 'workloadProbabilistic', s: 0.01, f: v => Math.round(v * 100) },
    btmShare: { p: 'btmShare', s: 0.01, f: v => Math.round(v * 100) },
    btmDelay: { p: 'btmDelay', s: 1, f: v => v },
    btmCapexMult: { p: 'btmCapexMult', s: 0.01, f: v => v.toFixed(2) },
    btmEnergyCost: { p: 'btmEnergyCost', s: 0.001, f: v => v.toFixed(3) }
  };

  // Log-scale sliders for thermodynamic and photonic computing multipliers
  const logSliders = {
    thermoGroundMult: { p: 'thermoGroundMult', min: 2, max: 4 }, // 10^2 to 10^4
    thermoSpaceMult: { p: 'thermoSpaceMult', min: 2, max: 5 },   // 10^2 to 10^5
    photonicGroundMult: { p: 'photonicGroundMult', min: 1, max: 3 }, // 10^1 to 10^3
    photonicSpaceMult: { p: 'photonicSpaceMult', min: 1, max: 4 }    // 10^1 to 10^4
  };
  Object.entries(logSliders).forEach(([id, cfg]) => {
    const el = document.getElementById(id);
    const val = document.getElementById('v-' + id);
    if (!el) return;
    el.addEventListener('input', () => {
      P[cfg.p] = Math.pow(10, parseFloat(el.value));
      if (val) val.textContent = Math.round(P[cfg.p]);
      update();
    });
  });
  
  Object.entries(sliders).forEach(([id, cfg]) => {
    const el = document.getElementById(id);
    const val = document.getElementById('v-' + id);
    if (!el) return;
    el.addEventListener('input', () => {
      P[cfg.p] = parseFloat(el.value) * cfg.s;
      if (val) val.textContent = cfg.f(P[cfg.p]);
      update();
    });
  });

  // Special handling for demand2025 - slider is in Exaflops, model uses GW
  const demandSlider = document.getElementById('demand2025');
  const demandVal = document.getElementById('v-demand2025');
  const demandContext = document.getElementById('demand-context');
  if (demandSlider) {
    demandSlider.addEventListener('input', () => {
      const exaflops = parseFloat(demandSlider.value);
      // Convert Exaflops to GW for model: GW = Exaflops * 1000 / BASELINE_EFFICIENCY
      P.demand2025 = exaflops * 1000 / BASELINE_EFFICIENCY;
      if (demandVal) demandVal.textContent = exaflops;
      if (demandContext) demandContext.textContent = formatDemandContext(exaflops);
      update();
    });
  }

  document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', () => {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
      tab.classList.add('active');
      document.querySelector(`.tab-panel[data-tab="${tab.dataset.tab}"]`).classList.add('active');
    });
  });
  
  update();
});
</script>
</body>
</html>
